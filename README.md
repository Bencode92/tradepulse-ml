# ü§ñ TradePulse ML - FinBERT Fine-tuning

Repository priv√© pour le fine-tuning de mod√®les FinBERT pour l'analyse de sentiment financier de TradePulse avec **validation automatique des datasets** et **interface web moderne**.

## üöÄ Utilisation rapide

### 1. Via l'√©diteur web (NOUVEAU ! üî•)

1. **Ouvrir l'√©diteur** : `open news_editor.html` ou double-clic
2. **Charger un dataset** : Import local ou depuis GitHub
3. **√âditer visuellement** : Tableau interactif avec validation temps r√©el
4. **Sauvegarder** : Download local ou commit direct vers GitHub
5. **Auto-d√©clenchement** : Le commit lance automatiquement le fine-tuning !

### 2. Via pipeline express (NOUVEAU ! ‚ö°)

```bash
# Pipeline complet en une commande
./scripts/auto-pipeline.sh pipeline

# Commandes rapides
./scripts/auto-pipeline.sh latest      # Affiche le dernier dataset
./scripts/auto-pipeline.sh validate    # Valide le dernier dataset  
./scripts/auto-pipeline.sh train       # Entra√Æne sur le dernier dataset
```

### 3. Via scripts avec auto-s√©lection (NOUVEAU ! üéØ)

```bash
# Plus besoin de sp√©cifier le fichier !
python scripts/validate_dataset.py     # Auto-s√©lectionne le dernier CSV
python scripts/finetune.py --output_dir models/test  # Auto-s√©lectionne le dernier CSV

# R√©trocompatibilit√© : les anciens appels fonctionnent toujours
python scripts/validate_dataset.py datasets/news_20250706.csv
python scripts/finetune.py --dataset datasets/news_20250706.csv --output_dir models/test
```

### 4. Via GitHub Actions (existant)

1. **Pr√©parez votre dataset** dans le dossier `datasets/`
2. **Validation automatique** : Le syst√®me v√©rifie la qualit√© de vos donn√©es
3. Allez dans l'onglet **Actions** de ce repository
4. S√©lectionnez "ü§ñ TradePulse FinBERT Fine-tuning"
5. Cliquez "Run workflow" et configurez :
   - **Dataset**: `auto-latest` (dernier dataset) ou nom sp√©cifique
   - **Model**: `yiyanghkust/finbert-tone`
   - **Epochs**: `3`
   - **Learning rate**: `2e-5`
   - **Push to HuggingFace**: `true/false`

## üìÅ Structure du repository

```
tradepulse-ml/
‚îú‚îÄ‚îÄ üåê news_editor.html              # NOUVEAU ! √âditeur web moderne
‚îú‚îÄ‚îÄ üìÅ .github/workflows/            # GitHub Actions
‚îÇ   ‚îú‚îÄ‚îÄ finetune-model.yml           # Workflow de fine-tuning (am√©lior√©)
‚îÇ   ‚îú‚îÄ‚îÄ dataset-quality-gate.yml     # Validation des datasets
‚îÇ   ‚îú‚îÄ‚îÄ collect-dataset.yml          # Collecte automatique
‚îÇ   ‚îî‚îÄ‚îÄ tests.yml                    # Tests automatis√©s
‚îú‚îÄ‚îÄ üìÅ datasets/                     # Datasets d'entra√Ænement
‚îÇ   ‚îú‚îÄ‚îÄ news_20250705.csv            # Exemple dataset (15 √©chantillons)
‚îÇ   ‚îú‚îÄ‚îÄ financial_news_20250706.csv  # Dataset test (20 √©chantillons)
‚îÇ   ‚îú‚îÄ‚îÄ news_20250706.csv            # Dataset test (25 √©chantillons)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ raw/                      # Donn√©es brutes
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ labeled/                  # Donn√©es √©tiquet√©es
‚îú‚îÄ‚îÄ üìÅ models/                       # Mod√®les entra√Æn√©s (g√©n√©r√©)
‚îú‚îÄ‚îÄ üìÅ scripts/                      # Scripts Python
‚îÇ   ‚îú‚îÄ‚îÄ finetune.py                  # Script principal de fine-tuning (+ auto-s√©lection)
‚îÇ   ‚îú‚îÄ‚îÄ validate_dataset.py          # Validation datasets (+ auto-s√©lection)
‚îÇ   ‚îú‚îÄ‚îÄ utils.py                     # NOUVEAU ! Utilitaires d'auto-s√©lection
‚îÇ   ‚îú‚îÄ‚îÄ auto-pipeline.sh             # NOUVEAU ! Pipeline express
‚îÇ   ‚îú‚îÄ‚îÄ collect_news.py              # Collecte d'actualit√©s
‚îÇ   ‚îî‚îÄ‚îÄ test_validation.py           # Tests de validation
‚îú‚îÄ‚îÄ üìÅ config/                       # Configuration
‚îú‚îÄ‚îÄ üìÅ notebooks/                    # Jupyter notebooks
‚îú‚îÄ‚îÄ requirements.txt                 # D√©pendances Python de base
‚îú‚îÄ‚îÄ requirements-ml.txt              # D√©pendances ML compl√®tes
‚îú‚îÄ‚îÄ DATASET_WORKFLOW.md             # Guide validation
‚îú‚îÄ‚îÄ ENTERPRISE_UPGRADE.md           # Guide entreprise
‚îú‚îÄ‚îÄ BUG_FIXES_AND_FEATURES.md      # Changelog
‚îî‚îÄ‚îÄ README.md                       # Ce fichier
```

## üé® √âditeur web moderne (NOUVEAU !)

### ‚ú® Fonctionnalit√©s

- **Interface glassmorphism** avec design moderne
- **Validation temps r√©el** avec statistiques visuelles  
- **Int√©gration GitHub** : charger/sauver directement
- **√âdition inline** : tableau enti√®rement √©ditable
- **Auto-d√©tection** du format et des erreurs
- **D√©clenchement workflows** depuis l'interface

### üîß Utilisation

```bash
# 1. Ouvrir l'√©diteur
open news_editor.html  # ou double-clic

# 2. Configurer GitHub (optionnel)
Repository: Bencode92/tradepulse-ml
Branch: main
Token: ghp_xxx... (scope: repo)

# 3. Charger un dataset
- "Charger dernier CSV GitHub" (auto-s√©lection)
- "Importer CSV local" (fichier local)

# 4. √âditer les donn√©es
- Cliquer dans les cellules pour √©diter
- Ajouter des lignes avec le bouton "+"
- Validation automatique en temps r√©el

# 5. Sauvegarder
- "T√©l√©charger CSV" (export local)
- "Commit vers GitHub" (push direct + d√©clenche CI)
```

## ‚ö° Pipeline express (NOUVEAU !)

### üöÄ Commandes disponibles

```bash
# Affichage
./scripts/auto-pipeline.sh latest     # Dernier dataset + aper√ßu
./scripts/auto-pipeline.sh list       # Liste tous les datasets

# Workflows
./scripts/auto-pipeline.sh validate   # Validation seule
./scripts/auto-pipeline.sh train      # Fine-tuning seul  
./scripts/auto-pipeline.sh pipeline   # Validation + Fine-tuning

# Tests & d√©ploiement
./scripts/auto-pipeline.sh test models/finbert-xxx    # Test rapide
./scripts/auto-pipeline.sh deploy models/finbert-xxx  # Push HuggingFace
```

### üí´ Exemples d'utilisation

```bash
# Workflow quotidien simplifi√©
./scripts/auto-pipeline.sh latest     # V√©rifier le dernier dataset
./scripts/auto-pipeline.sh pipeline   # Lancer le pipeline complet
# ‚Üì R√©sultat : validation + entra√Ænement + mod√®le pr√™t !

# Workflow avec fichier sp√©cifique
./scripts/auto-pipeline.sh validate datasets/news_20250706.csv
./scripts/auto-pipeline.sh train datasets/news_20250706.csv models/my-model

# Test d'un mod√®le entra√Æn√©
./scripts/auto-pipeline.sh test models/finbert-20250706_142230
```

## üéØ Auto-s√©lection intelligente (NOUVEAU !)

Tous les scripts d√©tectent automatiquement le **dernier dataset** au format `news_YYYYMMDD.csv` :

### ‚úÖ Scripts avec auto-s√©lection

```bash
# Validation automatique
python scripts/validate_dataset.py
# ‚Üì √âquivalent √† :
# python scripts/validate_dataset.py datasets/news_20250706.csv

# Fine-tuning automatique  
python scripts/finetune.py --output_dir models/test
# ‚Üì √âquivalent √† :
# python scripts/finetune.py --dataset datasets/news_20250706.csv --output_dir models/test

# Pipeline express
./scripts/auto-pipeline.sh pipeline
# ‚Üì D√©tecte automatiquement le dernier dataset et l'utilise
```

### üîß Comment √ßa fonctionne

1. **D√©tection** : Scan du dossier `datasets/` pour fichiers `news_*.csv`
2. **Tri** : Tri alphab√©tique d√©croissant (YYYYMMDD) = plus r√©cent en premier
3. **S√©lection** : Utilise automatiquement le premier fichier trouv√©
4. **Fallback** : Si √©chec, erreur claire avec suggestions

## üîç Validation automatique des datasets

Le syst√®me valide automatiquement vos datasets pour garantir la qualit√© :

### ‚úÖ V√©rifications automatiques
- **Structure** : Colonnes `text` et `label` requises
- **Labels** : Seulement `positive`, `negative`, `neutral`
- **Qualit√©** : D√©tection doublons, textes vides, longueur
- **Distribution** : √âquilibrage des classes
- **Format** : CSV et JSON support√©s

### üìä Rapport de validation
```
üîç RAPPORT DE VALIDATION DATASET
==================================================

üìä STATISTIQUES:
  Total √©chantillons: 20
  Longueur moyenne: 156.4 caract√®res
  Doublons: 0

üìà DISTRIBUTION DES LABELS:
  positive: 8 (40.0%)
  negative: 6 (30.0%)  
  neutral: 6 (30.0%)

‚úÖ VALIDATION R√âUSSIE
```

## üìä Format des datasets

### Format CSV (Recommand√©)
```csv
text,label
"Apple reported strong earnings beating expectations...",positive
"Market volatility increased amid economic uncertainty...",negative
"Oil prices remained stable following OPEC meeting...",neutral
```

### Format JSON
```json
[
  {
    "text": "Apple reported strong earnings...",
    "label": "positive"
  },
  {
    "text": "Market volatility increased...",
    "label": "negative"
  }
]
```

### üìè Crit√®res de qualit√©
- **Labels valides** : `positive`, `negative`, `neutral` uniquement
- **Longueur texte** : 20-512 caract√®res recommand√©s
- **Pas de doublons** dans les textes
- **Distribution √©quilibr√©e** : √âviter >70% d'une seule classe
- **Minimum** : 10 √©chantillons (50+ recommand√©)

## ü§ñ Workflows automatis√©s

### 1. Dataset Quality Gate
- **D√©clenchement** : Pull Request touchant `datasets/`
- **Validation** : Structure, contenu, distribution
- **Rapport** : Commentaire automatique sur PR
- **Blocage** : Emp√™che merge si validation √©choue

### 2. Smart Fine-tuning
- **S√©lection auto** : Dernier dataset valid√© (`auto-latest`)
- **D√©clenchement** : Push sur `datasets/` apr√®s validation
- **Configuration** : Param√®tres optimis√©s par d√©faut
- **Artifacts** : Mod√®les et logs automatiquement sauv√©s

### 3. Collecte automatique (existant)
- **Source** : APIs d'actualit√©s financi√®res
- **Filtrage** : Mots-cl√©s financiers
- **Nettoyage** : Suppression doublons et contenu non pertinent
- **Format** : Export direct en CSV pr√™t pour labeling

## ‚öôÔ∏è Configuration

### Variables d'environnement (GitHub Secrets)

Pour utiliser les fonctionnalit√©s avanc√©es, configurez ces secrets dans **Settings > Secrets**:

- `HF_TOKEN`: Token HuggingFace (obligatoire pour push de mod√®les)
- `WANDB_API_KEY`: Token Weights & Biases (optionnel)

### Arguments des scripts (mise √† jour)

#### Script de validation
```bash
python scripts/validate_dataset.py [dataset_path] [options]
```

| Argument | Description | D√©faut |
|----------|-------------|---------|
| `dataset_path` | Chemin vers le CSV/JSON (optionnel avec auto-s√©lection) | Auto-d√©tection |
| `--max-length` | Longueur max des textes | `512` |
| `--min-samples` | √âchantillons minimum | `10` |
| `--quiet` | Mode silencieux | `False` |
| `--output-json` | Rapport JSON | `None` |

#### Script de fine-tuning
```bash
python scripts/finetune.py --output_dir models/test [options]
```

| Argument | Description | D√©faut |
|----------|-------------|---------|
| `--dataset` | Chemin vers le dataset (optionnel avec auto-s√©lection) | Auto-d√©tection |
| `--output_dir` | R√©pertoire de sortie | **Requis** |
| `--model_name` | Mod√®le de base | `yiyanghkust/finbert-tone` |
| `--epochs` | Nombre d'√©poques | `3` |
| `--lr` | Taux d'apprentissage | `2e-5` |
| `--train_bs` | Batch size train | `16` |
| `--eval_bs` | Batch size eval | `32` |
| `--push` | Push vers HF Hub | `False` |
| `--hub_id` | ID du repo HF | `None` |

## üìà Monitoring & MLOps

### Logs d'entra√Ænement
- **TensorBoard**: `models/[model_name]/logs/`
- **Fichiers log**: `finetune.log`
- **Rapport**: `models/[model_name]/training_report.json`

### GitHub Actions
- **Artifacts** : Mod√®les et logs t√©l√©chargeables
- **Notifications** : Statut des jobs par email
- **History** : Historique complet des entra√Ænements

### M√©triques g√©n√©r√©es
- **Accuracy**: Pr√©cision globale
- **F1-Score**: Score F1 pond√©r√©
- **Precision**: Pr√©cision par classe
- **Recall**: Rappel par classe

## üîß Mod√®les support√©s

- `yiyanghkust/finbert-tone` (Recommand√©)
- `ProsusAI/finbert`
- `nlptown/bert-base-multilingual-uncased-sentiment`

## üìù Exemples d'utilisation compl√®te

### 1. Workflow moderne avec √©diteur web

```bash
# 1. Ouvrir l'√©diteur
open news_editor.html

# 2. Charger le dernier dataset depuis GitHub
# Clic sur "Charger dernier CSV GitHub"

# 3. √âditer visuellement les donn√©es
# - Corriger les labels invalides (rouge ‚Üí vert)
# - Ajouter des lignes manquantes
# - Validation temps r√©el

# 4. Commit vers GitHub
# Clic sur "Commit vers GitHub"
# ‚Üí D√©clenche automatiquement le fine-tuning !
```

### 2. Workflow pipeline express

```bash
# Pipeline ultra-rapide
./scripts/auto-pipeline.sh pipeline

# R√©sultat :
# ‚úÖ Dataset auto-d√©tect√© : datasets/news_20250706.csv
# ‚úÖ Validation r√©ussie
# ‚úÖ Fine-tuning termin√©
# ‚úÖ Mod√®le sauv√© : models/finbert-20250706_142230
```

### 3. Workflow traditionnel am√©lior√©

```bash
# Plus simple qu'avant !
python scripts/validate_dataset.py     # Auto-s√©lection
python scripts/finetune.py --output_dir models/finbert-auto

# √âquivalent √† l'ancienne m√©thode :
# python scripts/validate_dataset.py datasets/news_20250706.csv
# python scripts/finetune.py --dataset datasets/news_20250706.csv --output_dir models/finbert-auto
```

### 4. Test et d√©ploiement

```bash
# Test rapide du mod√®le
./scripts/auto-pipeline.sh test models/finbert-20250706_142230

# D√©ploiement vers HuggingFace
./scripts/auto-pipeline.sh deploy models/finbert-20250706_142230 Bencode92/tradepulse-finbert-v2
```

## üö® D√©pannage

### Auto-s√©lection

```bash
# V√©rifier les datasets disponibles
./scripts/auto-pipeline.sh list

# Tester l'auto-s√©lection
python -c "from scripts.utils import latest_dataset; print(latest_dataset())"

# Format requis pour l'auto-d√©tection
datasets/news_YYYYMMDD.csv  # Exemple : news_20250706.csv
```

### √âditeur web

```bash
# Probl√®mes de connexion GitHub
# ‚Üí V√©rifier le token (scope: repo)
# ‚Üí V√©rifier le nom du repository (owner/nom)

# Probl√®mes de validation
# ‚Üí Colonnes requises : text, label
# ‚Üí Labels valides : positive, negative, neutral

# Performance
# ‚Üí Fonctionne jusqu'√† ~1000 lignes
# ‚Üí Pour plus : utiliser les scripts Python
```

### Pipeline express

```bash
# Script non ex√©cutable
chmod +x scripts/auto-pipeline.sh

# Aucun dataset trouv√©
# ‚Üí Ajouter des fichiers au format news_YYYYMMDD.csv dans datasets/

# Erreur de d√©pendances
pip install -r requirements.txt
```

## üìö Documentation d√©taill√©e

- **[DATASET_WORKFLOW.md](DATASET_WORKFLOW.md)** : Guide complet du workflow de validation
- **[ENTERPRISE_UPGRADE.md](ENTERPRISE_UPGRADE.md)** : Guide de mise √† niveau entreprise
- **[BUG_FIXES_AND_FEATURES.md](BUG_FIXES_AND_FEATURES.md)** : Changelog complet
- **Validation locale** : `python scripts/validate_dataset.py --help`
- **Fine-tuning** : `python scripts/finetune.py --help`
- **Pipeline express** : `./scripts/auto-pipeline.sh help`

## üîÑ Int√©gration avec TradePulse

Le mod√®le fine-tun√© peut √™tre int√©gr√© dans le syst√®me principal :

1. **Push vers HuggingFace Hub** avec `--push --hub_id`
2. **Configurer le mod√®le custom** dans `fmp_news_updater.py`:
   ```python
   _FINBERT_MODEL = "Bencode92/tradepulse-finbert-custom"
   USE_CUSTOM_FINBERT = True
   ```

## üéØ Nouveaut√©s et am√©liorations

### ‚ú® Version actuelle
- **üåê √âditeur web moderne** avec interface glassmorphism
- **‚ö° Pipeline express** en une commande
- **üéØ Auto-s√©lection intelligente** dans tous les scripts
- **üîß Utilitaires Python** r√©utilisables (`utils.py`)
- **üìä Validation temps r√©el** dans l'interface web
- **üöÄ D√©clenchement workflows** depuis l'√©diteur

### üîÆ Prochaines √©tapes
- [ ] Int√©gration WANDB pour tracking avanc√©
- [ ] Tests A/B automatiques entre mod√®les  
- [ ] Pipeline de data augmentation
- [ ] Annotation collaborative multi-utilisateurs
- [ ] Monitoring de drift des donn√©es
- [ ] API REST pour int√©gration externe

## üìû Support

Pour toute question ou probl√®me :
- üêõ **Issues** : Ouvrir une issue dans ce repository
- üìã **Logs** : Consulter Actions ‚Üí Job logs
- üìñ **Documentation** : DATASET_WORKFLOW.md + ce README
- üîç **Validation** : `python scripts/validate_dataset.py --help`
- ‚ö° **Pipeline** : `./scripts/auto-pipeline.sh help`

---

**TradePulse ML** - Fine-tuning FinBERT avec interface web moderne et automation compl√®te üöÄ‚ú®

*Nouveau : √âditeur web + Auto-s√©lection + Pipeline express pour une productivit√© maximale !*
